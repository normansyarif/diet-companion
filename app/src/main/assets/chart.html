<html>
<head>
    <link rel="stylesheet" href="chart.css">
    <script src="jquery.js"></script>
    <script src="chart.js"></script>

    <style>
    	#now {
    		margin-top: 50px;
    		font-size: 1.5em;
    	}
        #overall {
            font-size: 1.3em;
        }
        #yesterday, #overall, #now {
        	text-align: center;
        }
        canvas {
        	margin-top: 30px;
        }
    </style>
</head>
<body>

<div class="content">
    <canvas id="myChart" width="400" height="300"></canvas>
    <p id="now"></p>
    <p id="overall"></p>
    <p id="yesterday"></p>
</div>

<script type="text/javascript">
    let dates = Android.getDates();
    let data = Android.getData();

    let dataArr = eval('(' + data + ')');

    // Calculate and parse overall progress
    if(dataArr.length >= 2) {
    	let first = parseFloat(dataArr[0]);
    	let last = parseFloat(dataArr[dataArr.length - 1]);
    	
    	$('#now').html(parseFloat(last.toFixed(1)) + ' kg');

    	if(first > last) {
    		let diff = parseFloat(first - last);
    		$('#overall').html('You have lost ' + parseFloat(diff.toFixed(1)) + ' kg. Good job!');
    		$('#overall').css('color', "#4CAF50");
    	}else if(first < last){
    		let diff = last - first;
    		$('#overall').html('You have gained ' + parseFloat(diff.toFixed(1)) + ' kg');
    		$('#overall').css('color', "#f44336");
    	}else{
    		$('#overall').html('You do\'t have any improvement');
    	}
    }else if(dataArr.length == 1) {
    	$('#now').html(parseFloat(dataArr[0].toFixed(1)) + ' kg');
    	$('#overall').remove();
    }else{
    	$('#overall').remove();
    	$('#now').remove();
    }

    // Compare and calculate the current value and the previous value
    if(dataArr.length >= 2) {
    	let secondToLast = parseFloat(dataArr[dataArr.length - 2]);
    	let last = parseFloat(dataArr[dataArr.length - 1]);
    	if(secondToLast > last) {
    		let diff = parseFloat(secondToLast - last);
    		$('#yesterday').html('You are ' + parseFloat(diff.toFixed(1)) + ' kg lighter than the last time');
    		$('#yesterday').css('color', "#4CAF50");
    	}else if(secondToLast < last){
    		let diff = last - secondToLast;
    		$('#yesterday').html('You are ' + parseFloat(diff.toFixed(1)) + ' kg heavier than the last time');
    		$('#yesterday').css('color', "#f44336");
    	}else{
    		$('#yesterday').html('You are the same weight as you were yesterday');
    	}
    }else{
    	$('#yesterday').remove();
    }

    // Chart config
    let ctx = $('#myChart');
    let myChart = new Chart(ctx, {
        type: 'line',
        data: {
            labels: eval('(' + dates + ')'),
            datasets: [{
                borderColor: "#3cba9f",
                data: eval('(' + data + ')'),
                fill: false
            }]
        },
        options: {
            scales: {
                yAxes: [{
                    ticks: {
                        beginAtZero: false
                    }
                }]
            },
            legend: {
    			display: false,
			}
        }
    });

</script>
</body>
</html>
